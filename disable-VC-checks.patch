From be1bad3771b1c074782d552101eaf8e79f5b424d Mon Sep 17 00:00:00 2001
From: Jakub Martisko <jamartis@redhat.com>
Date: Wed, 3 Jul 2019 12:39:22 +0200
Subject: [PATCH] add option to disable VC checks

---
 Makefile                       | 3 ++-
 clang/lib/Basic/CMakeLists.txt | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/Makefile b/Makefile
index bb40827..07611c9 100644
--- a/Makefile
+++ b/Makefile
@@ -12,6 +12,7 @@ CXX ?= c++
 DEFAULT_FLAVOUR ?= release
 PREFIX ?= /opt/divine
 RELEASE_BUILD_TYPE ?= RelWithDebInfo
+CMAKE_GENERATE_VC ?= ON
 
 MAKEFLAGS ?= --no-print-directory
 OBJ ?= $(PWD)/_build.
@@ -56,7 +57,7 @@ asan_FLAGS = $(debug_FLAGS);CMAKE_CXX_FLAGS_DEBUG=$(asan_CXXFLAGS)
 
 toolchain_FLAGS += CMAKE_BUILD_TYPE=Release;TOOLCHAIN=ON; \
 		   CMAKE_CXX_COMPILER=$(CXX);CMAKE_C_COMPILER=$(CC); \
-		   CMAKE_INSTALL_PREFIX=${PREFIX}
+		   CMAKE_INSTALL_PREFIX=${PREFIX};GENERATE_VC=${CMAKE_GENERATE_VC}
 
 all: $(DEFAULT_FLAVOUR)
 
diff --git a/clang/lib/Basic/CMakeLists.txt b/clang/lib/Basic/CMakeLists.txt
index e82f451..d85b034 100644
--- a/clang/lib/Basic/CMakeLists.txt
+++ b/clang/lib/Basic/CMakeLists.txt
@@ -12,7 +12,7 @@ set(version_inc "${CMAKE_CURRENT_BINARY_DIR}/SVNVersion.inc")
 
 set(get_svn_script "${LLVM_CMAKE_PATH}/GetSVN.cmake")
 
-if(DEFINED llvm_vc AND DEFINED clang_vc)
+if(DEFINED llvm_vc AND DEFINED clang_vc AND GENERATE_VC)
   # Create custom target to generate the VC revision include.
   add_custom_command(OUTPUT "${version_inc}"
     DEPENDS "${llvm_vc}" "${clang_vc}" "${get_svn_script}"
-- 
2.22.0

